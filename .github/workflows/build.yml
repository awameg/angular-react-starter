name: test
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.token }}
    steps:
        - name: Check out repository code
          uses: actions/checkout@v3
        - name: get-npm-version
          id: package-version
          uses: martinbeentjes/npm-get-version-action@main
          with:
            path: angular
        - run: echo ${{ steps.package-version.outputs.current-version}}
        - run: git log -n 1 --pretty=format:%ae
        - name: get time
          id: get-time
          run: |
                echo "::set-output name=ext_time::gh run list --workflow build.yml | head -n 1 | awk -F'\t' '{print $8}'"

# Notifications
        - name: Send mail success
          if: always()
          uses: dawidd6/action-send-mail@v2
          with:
            server_address: smtp.yandex.ru
            server_port: 465
            username: ${{ secrets.EMAIL_NOTIFY }}
            password: ${{ secrets.EMAIL_PASSWORD }}
            subject: ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }}
            body: ${{ github.job }} job in worflow ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }} ${{ ext_time }}
            to: ${{ github.actor }}@users.noreply.github.com
            from: GitHub ${{ github.repository }}
            
